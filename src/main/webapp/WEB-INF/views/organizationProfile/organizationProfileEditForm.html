<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
<meta charset="utf-8" />
<title>编辑企业基信</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1" name="viewport" />
<meta content="" name="description" />
<meta content="" name="author" />
<#include "/common/cssResource.html"> <#include
"/common/jsResource.html">
<script src="${ctx}/metronic/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="${ctx}/metronic/global/plugins/ajaxfileupload.js" type="text/javascript"></script>
<script src="${ctx}/metronic/global/plugins/ajaxfileupload-variable-transfer.js" type="text/javascript"></script>
<script src="${ctx}/metronic/mobile/js/jquery.min.js" type="text/javascript"></script>
<script src="${ctx}/metronic/mobile/js/jquery-2.1.3.js" type="text/javascript"></script>
<script src="${ctx}/metronic/mobile/js/jquery.validate.min.js" type="text/javascript"></script>

<script>
window.onload = function(){
function getDate(){
var today = new Date(); 
var date; 
date = (today.getFullYear()) +"-" + (today.getMonth() + 1 ) + "-" + today.getDate() + "-" + today.toLocaleTimeString(); 
return date;
}
window.setInterval(function(){
document.getElementById("modify_time").value=getDate();
}, 1000);
}
</script>


<script type="text/javascript">
	$(document).ready(function() {

        var t_Profile_AppStatus_value = "${organizationProfile.t_Profile_AppStatus}";
        $("#t_Profile_AppStatus option[value='"+t_Profile_AppStatus_value+"']").attr("selected","selected");

        var t_Profile_RegulatorReq_value = "${organizationProfile.t_Profile_RegulatorReq}";
        $("#t_Profile_RegulatorReq option[value='"+t_Profile_RegulatorReq_value+"']").attr("selected","selected");


		var form = $('#inputForm');
		form.validate({
			errorElement : 'span', //default input error message container
			errorClass : 'help-block help-block-error', // default input error message class
			focusInvalid : false, // do not focus the last invalid input
			rules : {
				t_Profile_Email:{
					email : true
				},
				type : {
					required : true
				},
				link : {
					required : true,
					maxlength : 100
				},
				idx : {
					maxlength : 10,
					digits : true,
					required : true
				},
				shiroPermission : {
					maxlength : 50
				}
			},

			messages: {

				t_O_EmployeeAmount:{
					remote : "手机号码已存在",
					required: "请输入手机号码",
					isModile: "请输入一个有效的手机号码"
				},
			},
			invalidHandler : function(event, validator) { //display error alert on form submit
				App.scrollTo(form, 0);
			},

			highlight : function(element) { // hightlight error inputs
				$(element).closest('.form-group').removeClass(
						"has-success").addClass('has-error'); // set error class to the control group
			},

			unhighlight : function(element) { // revert the change done by hightlight

			},

			success : function(label, element) {
				var icon = $(element).parent('.input-icon').children(
						'i');
				$(element).closest('.form-group').removeClass(
						'has-error').addClass('has-success'); // set success class to the control group
				icon.removeClass("fa-warning").addClass("fa-check");
			},

		});

		$("#dirParent").hide();
		$("#menuParent").hide();
		$("#linkDiv").hide();

	});

	function submitForm(){
	var forminput = {
		"t_Profile_ID":document.getElementById("t_Profile_ID").value,
		"t_Profile_CertificationCode":document.getElementById("t_Profile_CertificationCode").value,
		"t_Profile_OrgName":document.getElementById("t_Profile_OrgName").value,
		"t_Profile_Qualification":document.getElementById("t_Profile_Qualification").value,
		"t_Profile_QualificationStatus":document.getElementById("t_Profile_QualificationStatus").value,
		"t_Profile_Mobile":document.getElementById("t_Profile_Mobile").value,
		"t_Profile_Contact":document.getElementById("t_Profile_Contact").value,
		"t_Profile_Email":document.getElementById("t_Profile_Email").value,
		"t_Profile_Address":document.getElementById("t_Profile_Address").value,
		"t_Profile_PostRet":document.getElementById("t_Profile_PostRet").value,
		"t_Profile_OrgType":document.getElementById("t_Profile_OrgType").value,
		"t_Profile_StatusRptRetAddress":document.getElementById("t_Profile_StatusRptRetAddress").value,
		"t_Profile_CurrentAddress":document.getElementById("t_Profile_CurrentAddress").value,
		"t_Profile_IPaddr":document.getElementById("t_Profile_IPaddr").value,
		"t_Profile_APIAcc":document.getElementById("t_Profile_APIAcc").value,
		"t_Profile_APIPWD":document.getElementById("t_Profile_APIPWD").value,
		"t_Profile_APIret":document.getElementById("t_Profile_APIret").value,
		"t_Profile_AgentCmpyName":document.getElementById("t_Profile_AgentCmpyName").value,
		"t_Profile_AppStatus":document.getElementById("t_Profile_AppStatus").value,
		"t_Profile_RetHTTPget":document.getElementById("t_Profile_RetHTTPget").value,
		"t_Profile_RegulatorReq":document.getElementById("t_Profile_RegulatorReq").value,
		"remark":document.getElementById("remark").value,
	};
	$.ajax({
		url: "${ctx}/OrganizationProfileController/editOrganizationProfile",
		type: 'POST',
		dataType : "json",
		async: false,
		contentType: "application/json",//关键是要加上这行
		traditional : true,//这使json格式的字符不会被转码
		data : JSON.stringify(forminput),
		processData: false,
		success: function (data) {
			alert("成功")
			parent.window.location.reload();
			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
			console.log(index)
			parent.layer.close(index);
		},
		error: function (data) {
			console.log(data)
			alert("失败");
		}
	});
	}

	function chkuploadfile(val){
		console.log(val)
		var uploadEventFile = document.getElementById("t_Profile_AgentCmpyName").value
		console.log(uploadEventFile)
		// var name;
		// name=prompt("请输入");
		// if (name.lastIndexOf("1") < 0 && uploadEventFile.lastIndexOf("2") < 0 && uploadEventFile.lastIndexOf("3") < 0) {//可判断以.xls和.xlsx结尾的excel
		// 	alert("只能上传png,jpg,jpeg格式且大小小于1m的图片文件");
		// 	return;
		// }
		if (uploadEventFile.lastIndexOf(".png") < 0 && uploadEventFile.lastIndexOf(".jpeg") < 0 && uploadEventFile.lastIndexOf(".jpg") < 0) {//可判断以.xls和.xlsx结尾的excel
			alert("只能上传png,jpg,jpeg格式且大小小于1m的图片文件");
			return;
		}else{
			var t_O_CertificationCode = $("#t_O_CertificationCode").val;
			console.log($("#t_Profile_CertificationCode").val())
			var formData = new FormData($('#inputForm')[0]);
			$.ajax({
				url: "${ctx}/OrganizationProfileController/OrgCertImgUpload?t_O_CertificationCode=" + $("#t_Profile_CertificationCode").val(),
				type: 'POST',
				data: formData,
				async: true,
				cache: false,
				contentType: false,
				processData: false,
				success: function (data) {
					var result = eval("("+data+")");
					if(result.retmsg === "succ"){
						document.getElementById("certimgmsg").innerText = ""
						document.getElementById("certimgmsg").innerText = "上传成功"
						document.getElementById("certimgmsg").display = ""
					}
					console.log(result);
				},
				error: function (data) {
					var result = eval("("+data+")");
					if(result.retmsg === "fail"){
						document.getElementById("certimgmsg").innerText = ""
						document.getElementById("certimgmsg").innerText = "上传失败"
						document.getElementById("certimgmsg").display = ""
					}
					alert(result.msg);
				}
			});
		}
	}

	function typeSelector(selector){
		var typeSelect = $(selector).find("option:selected").val();
		if (typeSelect == "" || typeSelect == "0") {
			$("#dirParent").hide();
			$("#menuParent").hide();
			$("#parentId").val("");
			$("#linkDiv").hide();
			$("#link").val("");
		} else if (typeSelect == "1") {
			$("#dirParent").show();
			$("#menuParent").hide();
			setParentId($("#dirParentSelector"));
			$("#linkDiv").show();
		} else if (typeSelect == "2") {
			$("#dirParent").hide();
			$("#menuParent").show();
			setParentId($("#menuParentSelector"));
			$("#linkDiv").hide();
			$("#link").val("");
		}
	}

	function setParentId(selector) {
		$("#parentId").val($(selector).find("option:selected").val());
	}

</script>
</head>
<body>
	<div class="portlet light bordered">
		<div class="portlet-body form">
			<!-- BEGIN FORM-->
			<form id="inputForm" class="form-horizontal form-row-seperated" enctype="multipart/form-data">
				<input type="hidden" name="platform" value="${platform}">
 					<div class="form-group">
						<label class="control-label col-sm-3">企业子账户ID<span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control" disabled="disabled"
														  name="t_Profile_ID" id="t_Profile_ID" value="${organizationProfile.t_Profile_ID}" />
							</div>
						</div>
					</div>
                    <div class="form-group">
						<label class="control-label col-sm-3">机构组织代码证 <span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control"
									name="t_Profile_CertificationCode" id="t_Profile_CertificationCode" value="${organizationProfile.t_Profile_CertificationCode}" disabled="disabled" />
							</div>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-3">公司名<span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control"
									name="t_Profile_OrgName" id="t_Profile_OrgName" value="${organizationProfile.t_Profile_OrgName}"/>
							</div>
						</div>
					</div>
					 <div class="form-group">
						<label class="control-label col-sm-3">企业等级<span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control"
									name="t_Profile_Qualification" id="t_Profile_Qualification" value="${organizationProfile.t_Profile_Qualification}" />
							</div>
						</div>
					</div>
				<div class="form-group">
					<label class="control-label col-sm-3">是否需要状态报告<span
							class="required"> * </span>
					</label>
					<div class="col-sm-9">
						<div class="input-icon right">
							<select class="bs-select form-control"  name="t_Profile_AppStatus" id="t_Profile_QualificationStatus" value="${organizationProfile.t_Profile_QualificationStatus}">
								<option value="on">是</option>
								<option value="off">否</option>
							</select>
						</div>
					</div>
				</div>
                    <div class="form-group">
						<label class="control-label col-sm-3">企业电话<span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control"
									name="t_Profile_Mobile" id="t_Profile_Mobile" value="${organizationProfile.t_Profile_Mobile}" />
							</div>
						</div>
					</div>
                    <div class="form-group">
						<label class="control-label col-sm-3">企业法人/联系人<span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control"
									name="t_Profile_Contact" id="t_Profile_Contact" value="${organizationProfile.t_Profile_Contact}" />
							</div>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-3">电邮<span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control"
									name="t_Profile_Email" id="t_Profile_Email" value="${organizationProfile.t_Profile_Email}"  placeholder="请先填写正确电邮地址"/>
							</div>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-3">地址<span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control"
									name="t_Profile_Address" id="t_Profile_Address" value="${organizationProfile.t_Profile_Address}" placeholder="请先正确填写公司地址"/>
							</div>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-3">接口账号<span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control"
									name="t_Profile_PostRet" id="t_Profile_PostRet" value="${organizationProfile.t_Profile_PostRet}" placeholder="请先开通杉德备付金账户"/>
							</div>
						</div>
					</div>
			<div class="form-group">
				<label class="control-label col-sm-3">企业类型<span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<i class="fa"></i> <input type="text" class="form-control"
												  name="t_Profile_OrgType" id="t_Profile_OrgType" value="${organizationProfile.t_Profile_OrgType}" placeholder="人力资源企业，普通企业，经销商/代理商"/>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-3">状态报告回调地址<span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<i class="fa"></i> <input type="text" class="form-control"
												  name="t_Profile_StatusRptRetAddress" id="t_Profile_StatusRptRetAddress" value="${organizationProfile.t_Profile_StatusRptRetAddress}" placeholder="api.58gongzi.com.cn/api/orgname"/>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-3">节点数<span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<i class="fa"></i> <input type="text" class="form-control"
												  name="t_Profile_CurrentAddress" id="t_Profile_CurrentAddress" value="${organizationProfile.t_Profile_CurrentAddress}" placeholder="1,2,3"/>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-3">API接口<span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<i class="fa"></i> <input type="text" class="form-control"
												  name="t_Profile_IPaddr" id="t_Profile_IPaddr" value="${organizationProfile.t_Profile_IPaddr}" placeholder="api.58gongzi.com.cn/api/orgname"/>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-3">API接口账号<span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<i class="fa"></i> <input type="text" class="form-control"
												  name="t_Profile_APIAcc" id="t_Profile_APIAcc" value="${organizationProfile.t_Profile_APIAcc}" placeholder="请先开接口功能"/>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-3">API接口密码 <span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<i class="fa"></i> <input type="text" class="form-control"
												  name="t_Profile_APIPWD" id="t_Profile_APIPWD" value="${organizationProfile.t_Profile_APIPWD}"/>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-3">接口速度 接口协议 连接节点<span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<i class="fa"></i> <input type="text" class="form-control"
												  name="t_Profile_APIret" id="t_Profile_APIret" value="${organizationProfile.t_Profile_APIret}"/>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-3">营业执照图片<span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
						<i id="certimgmsg" class="fa" style="color:blue;"></i><input type="file" class="form-control" style="width:100%" title="请选择文件"
						 id="t_Profile_AgentCmpyName" name="t_Profile_AgentCmpyName" value="${organizationProfile.t_Profile_AgentCmpyName}" onchange="javascript:chkuploadfile(this.value)">  <!-- https://blog.csdn.net/u010047432/article/details/89391568 -->
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-3">审核状态<span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<select class="bs-select form-control"  name="t_Profile_AppStatus" id="t_Profile_AppStatus" value="${organizationProfile.t_Profile_AppStatus}">
							<option value="approved">审核通过</option>
							<option value="pending">未审核</option>
						</select>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-sm-3">是否需要上行<span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<i class="fa"></i> <input type="text" class="form-control"
												  name="t_Profile_RetHTTPget" id="t_Profile_RetHTTPget" value="${organizationProfile.t_Profile_RetHTTPget}"/>
					</div>
				</div>
			</div>
					<div class="form-group">
						<label class="control-label col-sm-3">是否需要审核 <span
							class="required"> * </span>
						</label>
						<div class="col-sm-9">
							<div class="input-icon right">
								<i class="fa"></i> <input type="text" class="form-control"
														  name="t_Profile_RegulatorReq" id="t_Profile_RegulatorReq" value="${organizationProfile.t_Profile_RegulatorReq}"/>
							</div>
						</div>
					</div>
			<div class="form-group">
				<label class="control-label col-sm-3">备注 <span
						class="required"> * </span>
				</label>
				<div class="col-sm-9">
					<div class="input-icon right">
						<i class="fa"></i><textarea style="width:1000px;height:88px;" class="form-control"
													name="remark" id="remark" value="${organizationProfile.remark}"></textarea>
					</div>
				</div>
			</div>
					<div class="form-group">
						<label class="control-label col-sm-3">更新时间</label>
						<div class="col-sm-9">
							<div class="input-icon right">
							  <input type="text" class="form-control" name="modify_time" id="modify_time"/>
							</div>
						</div>
					</div>
				<div class="form-actions">
					<div class="row">
						<div class="col-sm-3">
						</div>
						<div class="col-sm-9">
							<button type="submit" class="btn green" onclick="submitForm()">提交</button>
							<button type="button" class="btn default" onclick="parent.layer.closeAll();">取消</button>
						</div>
					</div>
				</div>
			</form>
		</div>
		<!-- END FORM-->
	</div>
</body>
</html>