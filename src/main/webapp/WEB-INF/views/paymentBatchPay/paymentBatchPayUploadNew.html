<!DOCTYPE html>
<!-- saved from url=(0035)http://users.ucpaas.com/%20/l%20/#/ -->
<html>

<head>
    <title>企业批量支付管理</title>
    <meta http-equiv="Cache-Control" content="no-store">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta charset="utf-8">
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<!--     <#include "/common/commonContext.html">-->
    <script src="${ctx}/metronic/global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="${ctx}/metronic/global/plugins/ajaxfileupload-variable-transfer.js" type="text/javascript"></script>
    <link href="${ctx}/metronic/new_modules/app_info.css" rel="stylesheet" type="text/css" >
    <!-- /复制功能插件/ -->
    <script type="text/javascript" src="${ctx}/metronic/new_modules/clipboard.min.js"></script>
    <!-- 图表 -->
    <script type="text/javascript" src="${ctx}/metronic/new_modules/echarts.common.min.js"></script>
    <script src="${ctx}/metronic/mobile/js/bootstrap.min.js" type="text/javascript"></script>
    <link href="${ctx}/metronic/mobile/css/bootstrap.min.css" rel="stylesheet" type="text/css" >
    <#include "/common/cssResource.html">
    <link href="${ctx}/metronic/global/plugins/jquery-treetable/css/jquery.treetable.css" rel="stylesheet" type="text/css" />
    <link href="${ctx}/metronic/global/plugins/jquery-treetable/css/jquery.treetable.theme.default.css" rel="stylesheet" type="text/css" />
    <#include "/common/jsResource.html">
    <script src="${ctx}/metronic/global/plugins/jquery-treetable/jquery.treetable.js" type="text/javascript"></script>
    <script src="${ctx}/metronic/mobile/js/moment-with-locales.js" type="text/javascript"></script>
    <!-- // 日期插件 -->
    <script src="${ctx}/metronic/new_modules/bootstrap-datetimepicker.min.js"></script>
    <link href="${ctx}/metronic/new_modules/bootstrap-datetimepicker.min.css" rel="stylesheet" type="text/css" >


    <script type="text/javascript">
        /*
        var userId = '<c:out value="${sessionScope.USER.userId}" />';
        var orgId = '<c:out value="${sessionScope.ORG.orgId}" />';
        var authLevel = '<c:out value="${sessionScope.USER.authLevel}" />';
        var userType = '<c:out value="${sessionScope.USER.type}" />';
        var orgAmount= '<c:out value="${sessionScope.AGENT.orgAmount}" />';
        var loginUser = {userId: userId, orgId: orgId, authLevel: authLevel, type: userType ,orgAmount:orgAmount};
        */
        /**
         * 上传文件
         */
        var uploaded = false;
        var selected = false;
        var textareadata = true;
        var spanHTag = false;
        var inputZinital = null;

        var project;
        $(function(){
            project = new Project();
            project.init();
        });

        var Project = function(){

            this.init = function(){

                //模拟上传excel
                $("#uploadEventBtn").unbind("click").bind("click",function(){
                    $("#uploadEventFile").click();
                    document.getElementById("uploadFileStatus").innerHTML = "";
                });
                $("#uploadEventFile").bind("change",function(){
                    $("#uploadEventPath").attr("value",$("#uploadEventFile").val());
                });
                if($("#uploadEventFile").val() == ""){
                    document.getElementById("uploadbtn").disabled = true;
                    document.getElementById("uploadFileStatus").innerHTML = "";
                }else{
                    document.getElementById("uploadbtn").disabled = false;
                    document.getElementById("uploadFileStatus").innerHTML = "";
                }
            };
            //点击上传按钮
            this.uploadBtn = function(){
                var uploadEventFile = $("#uploadEventFile").val();
                if(uploadEventFile == '' && document.getElementById("PaymentBatchPayInputArea").innerText == '') {
                    alert("请选择excel或者输入用户信息,再上传");
                    return;
                }else {
                    if(document.getElementById("PaymentBatchPayInputArea").innerText !=''){
                        document.getElementById("uploadEventFile").value="";
                        document.getElementById("uploadEventFile").disabled = true;
                    }
                    if (uploadEventFile == '') {
                        if (document.getElementById("PaymentBatchPayInputArea").innerText == "") {
                            alert("请输入个人信息后,再上传");
                            return;
                        }
                    } else {
                        if (uploadEventFile.lastIndexOf(".xls") < 0) {//可判断以.xls和.xlsx结尾的excel
                            alert("只能上传Excel文件");
                            return;
                        }
                    }
                    var url = '/sample_war_exploded/PaymentBatchPayUploadController/paymentBatchPayUploadPullin';
                    var formData = new FormData($('form')[0]);
                    project.sendAjaxRequest(url, formData);
                }
            };
            this.sendAjaxRequest = function(url,formData){
                console.log(document.getElementById("t_FPROD_Name").value);
                if (document.getElementById("t_FPROD_Name").value == ""){
                    alert("请选择企业及产品");
                    return;
                }else{
                    $.ajax({
                        url : "/sample_war_exploded/PaymentBatchPayUploadController/paymentBatchPayUploadPullin?operationType=fileupload&t_FPROD_Name=" + encodeURI(encodeURI($("#t_FPROD_Name").val())) +
                            "&PaymentBatchPayInputArea=" + encodeURI(encodeURI(document.getElementById("PaymentBatchPayInputArea").innerText)),
                        type: "post",
                        // contentType: "application/x-www-form-urlencoded; charset=utf-8",
                        contentType: false,
                        async: true,
                        data: formData,
                        cache: false,
                        processData: false,
                        success : function(data) {
                            var result = eval("("+data+")");
                            if(result.ret === -1){
                                document.getElementById("uploadFileStatus").innerHTML = "上传失败，请更正后重新上传！"
                                alert(result.retMsg);
                                download_txt('err.txt',result.personalErrInfo,'txt')
                            } else if(result.ret === 0){
                                document.getElementById("uploadFileStatus").innerHTML = "上传成功"
                                alert(result.retMsg);
                                batchIDrefresh();
                            }
                        },
                        beforeSend: function(){
                            document.getElementById("uploadFileStatus").innerHTML = '<div style="cursor1: wait; width: 200px; height: 30px; line-height: 28px;padding-left: 30px; padding-right: 1px; background: #fff url(http://www.58gongzi.com.cn/metronic/layouts/layout4/img/loading-spinner-blue.gif) no-repeat scroll 5px 5px; font-family:\'Microsoft YaHei\';font-size:12px">文件上传中，请等待...</div>'
                        },
                        error : function(rs) {
                            var result = eval("(" + rs + ")");
                            document.getElementById("uploadFileStatus").innerHTML = "excel上传错误，请更正信息后上传"
                            alert(result.retMsg);
                            download_txt('err.txt', result.personalErrInfo, 'txt')
                        }
                    })
                }
            }
        }


        function removeSpan(innerVal){
            var enterTag = "<br>"
            var enterspace = "\n"
            var clearBegin = document.getElementById("PaymentBatchPayInputArea").innerHTML.replace(/<.*?>/img,"");
            var contentClear = clearBegin.replace(new RegExp(enterTag,'g'),"")
            var clearend = contentClear.replace(new RegExp(enterspace,'g'),"")
            if(inputZinital !== null) {
                if (!innerVal.indexOf("<")) {
                    textareadata = false
                    if(inputZinital === clearend) {
                        spanHTag = true
                        retdataI = inputZinital
                        return retdataI
                    }else{
                        spanHTag = false
                        retdataI = clearend
                        return retdataI
                    }
                }else{
                    if(inputZinital === clearend) {
                        spanHTag = false
                        retdataI = clearend
                        return retdataI
                    }else{
                        spanHTag = false
                        retdataI = clearend
                        return retdataI
                    }
                }
            }else{
                spanHTag = false
                // retdataI = innerVal
                retdataI = clearend
                return retdataI
            }
        }

        function textareadataChk(innerVal){
            var retdata = removeSpan(innerVal); //  check two data changes, if no changes, keep original data otherwise rewrite innerHTML with highlight letters
            if(spanHTag){
                document.getElementById("PaymentBatchPayInputArea").innerHTML = innerVal;
                spanHTag = false;
            }else{
                document.getElementById("PaymentBatchPayInputArea").innerHTML = retdata;
            }
            var inputZ = null;
            inputZ = retdata;
            if(!inputZ){
                document.getElementById("uploadEventFile").disabled = false;
                textareadata = true;
                textareadatafmt =true;
            }
            if(inputZ !="" && !spanHTag) {
                document.getElementById("uploadEventFile").value = "";
                document.getElementById("uploadEventFile").disabled = true;
                document.getElementById("uploadFileStatus").innerHTML = "";
                // var format = /^((([\u4e00-\u9fa5]{2,13})\,(\d{15})\,(([1-9]{1})(\d{15}))\,(1[3-9]\d{9})\,((([1-9]{1})\d*)\;))|(([\u4e00-\u9fa5]{1,10})\,(\d{15})\,(d{16})\,(1[3-9]\d{9})\,((([1-9]{1})\d*)\;))|(([\u4e00-\u9fa5]{1,10})\,(\d{15})\,(d{18})\,(1[3-9]\d{9})\,((([1-9]{1})\d*)\;))|(([\u4e00-\u9fa5]{1,10})\,(\d{18})\,(d{18})\,(1[3-9]\d{9})\,((([1-9]{1})\d*)\;))|(([\u4e00-\u9fa5]{1,10})\,(\d{18})\,(d{18})\,(1[3-9]\d{9})\,((([1-9]{1})\d*)\;))|(([\u4e00-\u9fa5]{1,10})\,(\d{18})\,(([1-9]{1})(\d{15}))\,(1[3-9]\d{9})\,((([1-9]{1})\d*)\;))|(([\u4e00-\u9fa5]{1,10})\,(\d{17}(\d|X|x))\,(([1-9]{1})(\d{15}))\,(1[3-9]\d{9})\,((([1-9]{1})\d*)\;))|(([\u4e00-\u9fa5]{1,10})\,(\d{17}(\d|X|x))\,(d{16})\,(1[3-9]\d{9})\,((([1-9]{1})\d*)\;))|(([\u4e00-\u9fa5]{1,10})\,(\d{17}(\d|X|x))\,(d{18})\,(1[3-9]\d{9})\,((([1-9]{1})\d*)\;))){1,}$/
                var format = /^(([\u4e00-\u9fa5A-z0-9]+)\,([\u4e00-\u9fa5A-z0-9]+)\,([\u4e00-\u9fa5A-z0-9]+)\,([\u4e00-\u9fa5A-z0-9]+)\,(([\u4e00-\u9fa5A-z0-9]+)\;)){1,}$/
                if (!format.test(inputZ) ) {
                    var fmtErr = "<span title='输入格式错误' style='color:#ff0000;'>" + "*输入格式错误错误，请检查输入的每一项格式和分隔符是否正确" + "</span>"
                    textareadatafmt = false;
                    textareadata = false;
                } else{
                    inputZinital = inputZ;
                    textareadata = true;
                    textareadatafmt = true;
                    var fmtErr = "";
                    var FeeAarry = inputZ.split(";");    //截取字符串
                    var FeeAarryCount = null
                    FeeAarryCount = FeeAarry.length - 1
                    for (var i = 0; i < FeeAarryCount; i++) {
                        var RangeArrary = FeeAarry[i].split(",");
                        for (var j = 0; j < 5; j++) {
                            switch (j) {
                                case 0 :
                                    var name = RangeArrary[j].replace(" ", "");
                                    var regName = /^[\u4e00-\u9fa5]{2,13}/;
                                    if (!regName.test(name)) {
                                        var nameErr = null
                                        nameErr = "<span style='color:#ff0000;'>" + name + "</span>"
                                        inputZ = inputZ.replace(new RegExp(name,'g'), nameErr)
                                        document.getElementById("PaymentBatchPayInputArea").innerHTML = inputZ
                                        spanHTag = true
                                        textareadata = false
                                    }
                                    break;
                                case 1 :
                                    var pid = RangeArrary[j].toString().replace(" ", "");
                                    // if (IdentityCodeValid(pid) === false) {
                                    //     textareadata = false
                                    // }
                                    var regIdNo = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                                    if (!regIdNo.test(pid)) {
                                        var pidErr = null
                                        pidErr = "<span style='color:#ff0000;'>" + pid + "</span>"
                                        inputZ = inputZ.replace(new RegExp(pid,'g'), pidErr)
                                        document.getElementById("PaymentBatchPayInputArea").innerHTML = inputZ
                                        spanHTag = true
                                        textareadata = false
                                    }
                                    break;
                                case 2 :
                                    var bankcard = RangeArrary[j].toString().replace(" ", "");
                                    var pattern = /^([1-9]{1})(\d{14}|\d{15}|\d{16}|\d{18})$/;
                                    if (!pattern.test(bankcard)) {
                                        var bacnkcardErr = null
                                        bacnkcardErr = "<span style='color:#ff0000;'>" + bankcard + "</span>"
                                        inputZ = inputZ.replace(new RegExp(bankcard,'g'), bacnkcardErr)
                                        document.getElementById("PaymentBatchPayInputArea").innerHTML = inputZ
                                        spanHTag = true
                                        textareadata = false
                                    }
                                    break;
                                case 3:
                                    var persnlMobile = RangeArrary[j].toString().replace(" ", "");
                                    var pattern = /^(13[0-9]|14[5-9]|15[012356789]|166|17[0-8]|18[0-9]|19[8-9])[0-9]{8}$/;
                                    if (!pattern.test(persnlMobile)) {
                                        var mobileErr = null
                                        mobileErr = "<span style='color:#ff0000;'>" + persnlMobile + "</span>"
                                        inputZ = inputZ.replace(new RegExp(persnlMobile,'g'), mobileErr)
                                        document.getElementById("PaymentBatchPayInputArea").innerHTML = inputZ
                                        spanHTag = true
                                        textareadata = false
                                    }
                                    break;
                                case 4:
                                    var persnlAmt = parseFloat(RangeArrary[j].replace(" ", ""));
                                    var pattern = /^[1-9]{1}\d{1,6}$/;
                                    if (!pattern.test(persnlAmt)) {
                                        var persnlAmtErr = null
                                        persnlAmtErr = "<span style='color:#ff0000;'>" + persnlAmt + "</span>"
                                        inputZ = inputZ.replace(new RegExp(persnlAmt,'g'), persnlAmtErr)
                                        document.getElementById("PaymentBatchPayInputArea").innerHTML = inputZ
                                        spanHTag = true
                                        textareadata = false
                                    }
                                    break;
                                    defaule:
                                        break
                            }
                        }
                    }
                    if (inputZ != "" && !textareadata) {
                        document.getElementById("uploadbtn").disabled = true;
                    } else {
                        document.getElementById("uploadbtn").disabled = false;
                    }
                }
                if(!textareadata && textareadatafmt){
                    document.getElementById("PaymentBatchPayInputArea").innerHTML = inputZ
                    document.getElementById("persnlErr").innerHTML = "*标红处错误，不符合该项内容格式，请修正后才能提交"
                }else if(textareadata){
                    var correctContent = "<span style='color: #0000FF;' >" + "校验通过" + "</span>"
                    document.getElementById("persnlErr").innerHTML = correctContent
                }else if(!textareadatafmt){
                    document.getElementById("persnlErr").innerHTML = fmtErr
                }else if(textareadatafmt){
                    document.getElementById("persnlErr").innerHTML = fmtErr
                }
            }else{
                document.getElementById("persnlErr").innerHTML = ""
            }
        }       //验证错误信息
        function debounce(func,delay) {
            let timeout;
            return function (arguments) {
                if (timeout) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        func.call(this, arguments);
                    }, delay);
                }
            }
        }

        function inputcheck(innerVal) {
            const inp = document.getElementById("PaymentBatchPayInputArea")
            let debounceInpChk = debounce(textareadataChk(innerVal), 5000)
            inp.addEventListener("onmouseout", e => {
                debounceInpChk(e.target.value);
            })
        }

        //download Err data in txt
        function download_txt(filename,content,contentType) {
            if (!contentType) contentType = 'application/octet-stream';
            var a = document.createElement('a');
            var blob = new Blob([content], { 'type': contentType });
            a.href = window.URL.createObjectURL(blob);
            a.download = filename;
            a.click();
        }

        function batchIDrefresh(){
            $.ajax({
                url: "/sample_war_exploded/PaymentBatchPayUploadController/paymentBatchPayUploadBatchChange?t_PIBU_Orgname=" + encodeURI(encodeURI($("#t_PIBU_Orgname").val())),
                type: 'POST',
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                async: true,
                cache: false,
                processData: false,
                success: function(dataFProdC) {
                    kickoutcheck(dataFProdC);
                    var result = eval("(" + dataFProdC + ")");
                    // console.log(result.FinanceProduct);
                    if(result.ret == "0") {
                        // console.log(dataFProdC);
                        var batchPBbatchIDSelect = document.getElementById("batch_PB_batchID");
                        batchPBbatchIDSelect.options.length=0;/**清空下拉框的值*/
                        if((result.paymentBatchPayUpload!=null)&&(result.paymentBatchPayUpload.length!=0)) {
                            for(var i=0; i<=result.paymentBatchPayUpload.length; i++){
                                var opBatch = new Option();
                                opBatch.text = result.paymentBatchPayUpload[i].batch_PB_batchID;
                                opBatch.value = result.paymentBatchPayUpload[i].batch_PB_batchID;
                                batchPBbatchIDSelect.options.add(opBatch);
                            }}else if(result.FinanceProduct.length==0){
                            var op = new Option();
                            op.text = "<--- 请先上传人员 --->";
                            op.value =  null;
                            FProdNameSelect.options.add(op);
                        }
                    } else {
                        $.toptip('批量选择出错出错，请联系技术支持', 'error');
                    }
                },
                error: function(dataFProdC) {
                    console.log(dataFProdC);
                }
            });
        }

        function downLoadTemplate(obj){  //下载模板按钮的监听器
                                         //var url = webContext + '/filetemplate\\组织用户信息模板.xlsx';
            var id = '5d96a465c9bd400aaad8184a57661e49';
            window.location.href="/sample_war_exploded/PaymentBatchPayUploadController/paymentBatchPayUploadAdd?id=" + id;
        }


        function FProdFilter() {
            $.ajax({
                url: "/sample_war_exploded/PaymentBatchPayUploadController/paymentBatchPayUploadCompanyChange?t_PIBU_Orgname=" + encodeURI(encodeURI($("#t_PIBU_Orgname").val())),
                type: 'POST',
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                async: true,
                cache: false,
                processData: false,
                success: function(dataFProdC) {
                    selected = true;
                    kickoutcheck(dataFProdC);
                    var result = eval("(" + dataFProdC + ")");
                    // console.log(result.FinanceProduct);
                    if(result.ret == "0") {
                        var FProdNameSelect = document.getElementById("t_FPROD_Name");
                        FProdNameSelect.options.length=0;/**清空下拉框的值*/
                        if((result.FinanceProduct!=null)&&(result.FinanceProduct.length!=0)) {
                            for(var i=0; i<=result.FinanceProduct.length; i++){
                                var op = new Option();
                                op.text = result.FinanceProduct[i].t_FProd_Name + " - " + result.FinanceProduct[i].remark;
                                op.value = result.FinanceProduct[i].t_FProd_PersPool;
                                FProdNameSelect.options.add(op);
                            }}else if(result.FinanceProduct.length==0){
                            var op = new Option();
                            op.text = "<--- 请先添加产品 --->";
                            op.value =  null;
                            FProdNameSelect.options.add(op);
                        }
                    } else {
                        $.toptip('产品出错，请联系技术支持', 'error');
                    }
                },
                error: function(dataFProdC) {
                    $.toast(result.msg, "cancel");
                }
            });
        }


        function submitapplication() {
            event.preventDefault();
            var inputchkok = true;
            var obj=new Date();
            if(document.getElementById("EffectStartDate").value === "" || document.getElementById("EffectStartDate").value == null || document.getElementById("EffectStartDate").value > obj ){
                alert("请选择起始有效日期，并且起始日期必须大于等于今天");
                document.getElementById("EffectStartDate").focus();
                inputchkok = false
                return
            }
            if(document.getElementById("EffectEndDate").value === "" || document.getElementById("EffectEndDate").value == null || document.getElementById("EffectEndDate").value > obj ){
                alert("请选择起始有效日期，并且起始日期必须大于等于今天");
                document.getElementById("EffectEndDate").focus();
                inputchkok = false
                return
            }
            if(document.getElementById("EffectEndDate").value < document.getElementById("EffectStartDate").value ){
                alert("请选择结束有效日期，并且结束时间不能大于起始日期");
                document.getElementById("EffectEndDate").focus();
                inputchkok = false
                return
            }
            if(document.getElementById("PersonalInfoInputArea").innerText !== ""){
                document.getElementById("PersonalInfoInputArea").focus();
                alert("请先上传个人信息后，再绑定提交");
                inputchkok = false
                return
            }
            if(document.getElementById("uploadEventFile").value != ""){
                document.getElementById("uploadbtn").focus();
                alert("请先上传批量支付信息后，再绑定提交");
                inputchkok = false
                return
            }
            if(inputchkok){
                $.ajax({
                    url : "/sample_war_exploded/PaymentBatchPayUploadController/paymentBatchPayUpdateSub?operationType=filerefresh&t_FPROD_Name=" + encodeURI(encodeURI($("#t_FPROD_Name").val())) +
                        "&t_PIBU_Orgname=" + encodeURI(encodeURI($("#t_PIBU_Orgname").val())) +
                        "&batch_PB_batchID=" + encodeURI(encodeURI($("#batch_PB_batchID").val())) +
                        "&EffectStartDate=" + document.getElementById("EffectStartDate").value +
                        "&EffectEndDate=" + document.getElementById("EffectEndDate").value +
                        "&payrollDate=" + document.getElementById("payrollDate").value,
                    type: "post",
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    async: true,
                    cache: false,
                    processData: false,
                    success: function(dataUpload) {
                        kickoutcheck(dataUpload);
                        var result = eval("(" + dataUpload + ")");
                        if(result.ret == "0") {
                            alert(result.retMsg);
                        } else {
                            $.toptip('产品出错，请联系技术支持', 'error');
                        }
                    },
                    error: function(dataUpload) {
                        var result = eval("(" + dataUpload + ")");
                        alert(result.msg, "cancel");
                    }
                });
            }
        }

        function kickoutcheck(dataC){
            if (dataC.match("index")){
                window.location.href = "/sample_war_exploded/login";
                $.toptip('您已被踢出，请重新登录', 'error');
                return;
            }
        }

        $(function () {
            var dom = document.getElementsByClassName('input-datepicker-d')[0]
            $(".input-datepicker").datetimepicker({
                format: 'YYYY-MM-DD',
                locale: moment.locale('zh-cn')
            }).on('change', function (e) {
                console.log(e)
            });
            $(".input-datepicker-d").datetimepicker({
                format: 'hh:mm:ss',
                locale: moment.locale('zh-cn')
            }).on('change', function (e) {
            });
            $(".radio_original").on('click', function (e) {
                if (e.target.value == 1) {
                    dom.style.visibility = "visible";//隐藏
                } else {
                    dom.style.visibility = "hidden";//隐藏

                }
                // document.getElementById("demo").style.visibility = "visible";//显示
                console.log(e, "?????")
            })
        })

        function openDetails(){
            var t_batch_perslUploadStatus_batchid_value = document.getElementById("batch_PB_batchID").value;
            if(t_batch_perslUploadStatus_batchid_value === ""){
                alert("批次文件为空，请先导入选择后查看详情")
            }
            var openWindowWidth = $(document).width() * 0.8 + "px";
            var offsetH = ($(window).height()/5 - 20 > 120 ? 120 : $(window).height()/5 - 20) + "px";
            layer.open({
                type: 2,
                area: openWindowWidth,
                offset : offsetH,
                fix: false, //不固定
                maxmin: true,
                content: '${ctx}/PaymentBatchPayUploadStatusController/form?t_batch_perslUploadStatus_batchid='+encodeURI(encodeURI(t_batch_perslUploadStatus_batchid_value))+'&operationType=list&platform=0',
                success: function(layero, index){
                    layer.iframeAuto(index);
                }
            });
        }

        function chkuploadfile(val){
            if(val === null){
                document.getElementById("uploadbtn").disabled = true;
            }else{
                document.getElementById("uploadbtn").disabled = false;
            }
        }

        function datepickchk() {
            var beginDate = document.getElementById("EffectStartDate").value;
            var endDate = document.getElementById("EffectEndDate").value;
            if (beginDate != "" && endDate != "") {
                var d1 = new Date(beginDate.replace(/\-/g, "\/"));
                var d2 = new Date(endDate.replace(/\-/g, "\/"));
                if (d1 >= d2) {
                    alert("开始日期不能大于结束日期");
                }
            } else {
                alert("请选择起始与结束日期");
            }
        }
    </script>
    <style>
        .ml20 {
            border: 1px solid rgb(204, 204, 204); border-radius: 4px; width: 369px; height: 133px; margin-left: 0px; margin-top: -20px; resize: both; display: inline-block; box-sizing: border-box; font-size: 12px; overflow: auto;
        }
        .personalContent{
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
            height: 100px;
            margin-left: 0px;
            margin-top: -20px;
            resize:both;
            display: inline-block;
            box-sizing: border-box;
            outline-cloe:#000;
            font-size:12px;
            overflow:auto;
        }
        .personalContent:empty::before{
            font-color:#bfbfbf;
            color:#bfbfbf;
            content: attr(placeholder);
        }
    </style></head>

<body data-new-gr-c-s-check-loaded="14.1062.0" data-gr-ext-installed="" data-gr-ext-disabled="forever">

<div id="notIE9">
    <div id="layout" class="layout-wrap relative" style="min-height: 552px;">

        <div class="page-send-record">
            <div class="p-20 mt10">
                <div class="clearfix grid-list-head" style="border-bottom: 0px;"></div>
            </div>
            <div class="page-customerFinance p10">
                <div class="grid-list-head" style="border-bottom:2px solid#4169E1">
                    <div class="grid-tab active" style="width:180px">支付信息批量上传</div>
                </div>
                <div class="deliver">
                    <div class="variableSms">
                        <form enctype="multipart/form-data" id="excelUpload" name="excelUpload" class="form-horizontal">
                            <div class="vSms-item">
                                <div class="iconLine">
                                    <div class="numberIcon">1</div>
                                    <div class="lineY"></div>
                                </div>
                                <div class="processArea">
                                    <div class="processTitle">手工填入上传人员信息(姓名，身份证号，银行卡号，手机号，支付名目，支付金额;)(每条记录之间以分号;隔开,并且半角输入,支付如有小数必须为两位内的小数)</div>
                                    <div>
                                        <div contenteditable="true" id="PaymentBatchPayInputArea" name="PaymentBatchPayInputArea" style="" class="personalContent" placeholder="张三,54001519900304241X,5182999938839499,18618618661,100;李四,53001519700304241X,3182999932239499,13830001114,10000;" onmouseout="inputcheck(this.innerHTML)"></div>
                                        <div id="persnlErr" name="persnalErr" style="font-size: 14px;color:#ff0000; padding: 10px 0px;"></div>
                                    </div>
                                    <div class="processTitle">
                                        <label>企业名称<span class="required">*</span>
                                        </label>
                                        <div style="padding-left: 0px;">
                                            <select id="t_PIBU_Orgname" class="bs-select form-control" data-live-search="true" name="t_PIBU_Orgname" id="t_PIBU_Orgname" onchange="FProdFilter()">
                                                <#list OrganizationInfo as OrganizationInfoList>
                                                <option value="${OrganizationInfoList.t_O_OrgName}">
                                                    ${OrganizationInfoList.t_O_OrgName}</option>
                                            </#list>
                                            </select>
                                        </div>
                                    </div>
                                        <div class="processTitle">
                                            <label>工资产品名<span class="required">*</span>
                                            </label>
                                            <div style="padding-left: 0px;">
                                                <select class="bs-select form-control" data-live-search="true" name="t_FPROD_Name" id="t_FPROD_Name">
                                                    <#list FinanceProduct as FinanceProductList>
                                                    <option value="${FinanceProductList.t_FProd_Name}">${FinanceProductList.t_FProd_Name} - ${FinanceProductList.remark}</option>
                                                </#list>
                                                </select>
                                            </div>
                                        </div>
                                    <div class="processTitle">
                                        <label>到款账户<span class="required">*</span>
                                        </label>
                                        <div style="padding-left: 0px;">
                                            <select class="bs-select form-control" name="payrollDate" id="payrollDate">
                                                <option value="ewallet">个人企业电子钱包</option>
                                                <@shiro.hasPermission name="TREASURYINFO_SUPERADMINVIEW">
                                                <option value="bankcard">个人银行卡</option>
                                                </@shiro.hasPermission>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="vSms-item">
                                <div class="iconLine">
                                    <div class="numberIcon">2</div>
                                    <div class="lineY"></div>
                                </div>
                                <div class="processArea">
                                    <div class="processTitle"><input type="file" class="processTitle" title="请选择文件" name="uploadEventFile" id="uploadEventFile" onchange="javascript:chkuploadfile(this.innerText)">选择上传文件</div>
                                    <div>
                                        <div id="uploader-demo" class="templateArea">
                                            <div id="fileList" class="uploader-list"></div>
                                            <button id="uploadbtn" type="button" class="btn btn-green btn-warning" onclick="project.uploadBtn()" disabled="disabled">上传批量支付文件</button><div id="uploadFileStatus"></div>
                                        </div><br>
                                        <div id="downLoadxls" class="downloadTempDiv"><a href="#" class="btn btn-success btn-sm" onclick="javascript:;downLoadTemplate('5d96a465c9bd400aaad8184a57661e49')">下载模板</a>
                                        </div>
                                    </div>
                                    <div class="xlsxNeed"><br><br>
                                        注意:以下信息需在Excel表格中已文本格式保存。<br><br>1、第一列填写人名。<br>2、第二列填写身份证号。<br>3、第三位填写银行卡号。<br>
                                        4、第四位填写手机号。<br>5、第五位填写支付，可有小数点（且小数点后最多两位数字)。<br> 6、一次最多上传1万条数据。<br>7、一次只能导入一个文件。<br><br>
                                        辅助工具: <br><a href="https://qq.ip138.com/idsearch/index.asp" target="_blank">https://qq.ip138.com/idsearch/index.asp</a> (身份证校验，如有错误可以查询该系统做更正，如果校验位不合法且无法更正的请删除该条上传记录后重新上传文档，删除的记录请手动更新)<br>
                                        <a href="http://cha.yinhangkadata.com/#" target="_blank">http://cha.yinhangkadata.com/#</a> (银行卡校验，如有错误可以查询该系统做更正，如果校验位不合法且无法更正的请删除该条上传记录后重新上传文档，删除的记录请手动更新)
                                    </div>
                                </div>
                            </div>
                            <div class="vSms-item">
                                <div class="iconLine">
                                    <div class="numberIcon">3</div>
                                    <div class="lineY"></div>
                                </div>
                                <div class="processArea">
                                    <div class="processTitle">
                                        <div>
                                        <label>绑定批次<span class="required"> * </span>
                                        </label>
                                        </div>
                                    <div style="display:inline-block;width:800px">
                                        <div style="margin-left:0px;width:115%;display:inline-block;">
                                            <div style="width:100%;display:inline-block;">
                                                <select class="bs-select form-control" data-live-search="true" name="batch_PB_batchID"
                                                        id="batch_PB_batchID">
                                                    <#list paymentBatchPayUpload as paymentBatchPayUpload>
                                                    <option value="${paymentBatchPayUpload.batch_PB_batchID}">
                                                        ${paymentBatchPayUpload.batch_PB_batchID} </option>
                                                </#list>
                                            </div>
                                        </div>
                                        <div style="margin-left:0px;width:1000%;">
                                            <div style="width:150%;">
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="display:inline-block">
                                        <div style="margin-left:0px;display:inline-block">
                                            <a id="detaillist" style="width:20%;margin-right: 0px;" href="#" onclick="javascript:;openDetails()">查看详情</a>
                                        </div>
                                    </div>
                                    </div>
                                    <div class="processTitle">
                                        <label>支付日期:<span class="required">*</span>
                                        </label>
                                        <div style="padding-left: 0px;">
                                            <input id="EffectStartDate" autocomplete="off" placeholder="请选择支付日期" type="text"
                                                   rows="2" class="date-editor input-datepicker fl border input date-editor--date">
                                        </div>
                                    </div>
                                </div>
                                <br><br><br><br><br><br>
                            </div>
                            <div class="vSms-item">
                            <div class="processArea">
                                <div style="margin-left: 200px;"><button id="btn_upSubmit" onclick="submitapplication()" class="btn btn-lg search-btn ml80 send-btn" style="padding:0%;background-color:#4169E1;color:#ffffff;">批量支付信息上传提交 </button>
                                </div>
                            </div>
                        </div></form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        //弹窗开关
        var setMas = function () {
            const a = document.getElementsByClassName('maskNew')[0]
            const visible = getComputedStyle(a).display != 'none' && getComputedStyle(a).visibility != 'hidden';
            console.log(visible, "????")
            if (visible) {
                a.style.display = 'none'
            } else {
                a.style.display = 'inline-block'
            }

        }

        var setIndex = function () {
            var trs = document.getElementById('tr').getElementsByTagName("tr");//获得tr数组
            var titles = trs[0].getElementsByTagName("td");
            var value = document.getElementsByClassName('indexvalue')[0]
            value.innerHTML = titles[4].innerHTML
            setMas()
        }
        var wb;//读取完成的数据
        var rABS = false; //是否将文件读取为二进制字符串
        function importf(obj) {//导入
            if (!obj.files) {
                return;
            }
            var f = obj.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                var data = e.target.result;
                console.log(data, "?????")
            }
        }

        function fixdata(data) { //文件流转BinaryString
            var o = "",
                l = 0,
                w = 10240;
            for (; l < data.byteLength / w; ++l) o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));
            o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));
            return o;
        }

    </script>
    <style>
        .mask-ctx[data-v-e] {
            background-color: #FFF;
            width: 740px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translatex(-50%) translateY(-50%);
        }

        .mask-ctx .ctx[data-v-e] {
            padding: 20px;
            height: 500px;
        }

        .mask-ctx .ctx .mobileWrap[data-v-e] {
            width: 100%;
            height: 300px;
            word-break: break-all;
            overflow: auto;
        }
    </style>



</div></body></html>
